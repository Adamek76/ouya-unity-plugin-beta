task copyJar(dependsOn: ':java:build', type: Copy) {
	from new File(project(':java').buildDir, 'bundles/release/classes.jar')
	into 'Assets/Plugins/Android/libs'
	rename {'ouya.jar'}
}

task copyDll(dependsOn: ':cs:makeDll', type: Copy) {
	from new File(project(':cs').buildDir, 'ouya.dll')
	into 'Assets/Ouya/SDK'
}

task copyFiles(dependsOn: ['copyJar', 'copyDll'])

task unityPackage(dependsOn: 'copyFiles') {
	def unityExecutable = project.hasProperty('unityExecutable') ?
		project.property('unityExecutable') :
		'/Applications/Unity/Unity.app/Contents/MacOS/Unity'

	def logFile = file("$buildDir/unityPackage.log")
	logFile.parentFile.mkdirs()

	project.exec {
		commandLine unityExecutable
		args '-batchMode'
		args '-quit'
		args '-projectPath'
		args file('.')
		args '-exportPackage'
		args 'Assets'
		args file("$buildDir/ouya-unity-plugin.unityPackage")
		args '-cleanedLogFile'
		args logFile
		args '-quit'
	}
	println logFile.text
}
